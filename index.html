<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>MoW 2 Draft Project V11</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="logo-title">
        <img src="favicon.ico" alt="MoW2" class="logo-icon" />
        <div>
          <h1>MoW 2 Draft Project</h1>
          <div class="subtitle">Драфт-команд для Men of War II</div>
        </div>
      </div>
      <div class="header-right">
        <span class="version-tag">V11</span>
      </div>
    </header>

    <main class="app-body">
      <!-- Главный экран -->
      <section id="screen-menu" class="screen active">
        <div class="screen-header">
          <h2>Главное меню</h2>
        </div>
        <div class="menu-grid">
          <div class="menu-card" data-target="offline">
            <h2>Оффлайн драфт</h2>
            <p>Тренируй драфт: ты против ИИ, ИИ против ИИ или ручной режим.</p>
          </div>
          <div class="menu-card" data-target="online">
            <h2>Онлайн комнаты</h2>
            <p>Создавай комнаты, приглашай капитанов и зрителей, драфтьте вместе.</p>
          </div>
          <div class="menu-card" data-target="players">
            <h2>Игроки и статистика</h2>
            <p>Редактируй MMR, DPM и роли игроков. Эта база используется ИИ.</p>
          </div>
          <div class="menu-card" data-target="admin">
            <h2>Админ-панель</h2>
            <p>Глобальная база игроков, стратегии ИИ и настройка паролей.</p>
          </div>
        </div>
      </section>

      <!-- Оффлайн драфт -->
      <section id="screen-offline" class="screen">
        <div class="screen-header">
          <h2>Оффлайн драфт</h2>
          <button class="back-btn" data-back>Назад в меню</button>
        </div>

        <div class="card">
          <div class="card-row">
            <div>
              <div class="form-row">
                <label>Карта</label>
                <select id="offline-map-select"></select>
              </div>
              <div class="form-row">
                <label>Режим</label>
                <select id="offline-mode-select">
                  <option value="human_vs_ai">Я против ИИ</option>
                  <option value="ai_vs_ai">ИИ против ИИ</option>
                  <option value="manual">Драфт самостоятельный</option>
                </select>
              </div>
              
              <div class="form-row">
                <label>Капитаны команд</label>
                <div class="dual-select-row">
                  <select id="offline-captain1">
                    <option value="">— не выбран —</option>
                  </select>
                  <select id="offline-captain2">
                    <option value="">— не выбран —</option>
                  </select>
                </div>
              </div>
<div class="form-row" id="offline-human-side-row">
                <label>За какого капитана играешь ты?</label>
                <select id="offline-human-side">
                  <option value="team1">Капитан 1 (Команда 1)</option>
                  <option value="team2">Капитан 2 (Команда 2)</option>
                </select>
              </div>
              <div class="form-row">
                <label>Стратегии ИИ (Команда 1 / Команда 2)</label>
                <div class="dual-select-row">
                  <select id="offline-ai-strategy-1">
                    <option value="balanced">Сбалансированная</option>
                    <option value="infantry_focus">Фокус на пехоте</option>
                    <option value="motorized_focus">Фокус на мотопехоте</option>
                    <option value="tanks_focus">Фокус на танках</option>
                    <option value="artillery_focus">Фокус на арте</option>
                    <option value="infantry_mech_mix">Пехота + механика</option>
                    <option value="heavy_at_focus">Тяжёлые танки и ПТО</option>
                    <option value="aa_defense">ПВО и оборона</option>
                    <option value="max_dpm">Максимум DPM</option>
                    <option value="counter_enemy">Контрпик по ролям</option>
                  </select>
                  <select id="offline-ai-strategy-2">
                    <option value="balanced">Сбалансированная</option>
                    <option value="infantry_focus">Фокус на пехоте</option>
                    <option value="motorized_focus">Фокус на мотопехоте</option>
                    <option value="tanks_focus">Фокус на танках</option>
                    <option value="artillery_focus">Фокус на арте</option>
                    <option value="infantry_mech_mix">Пехота + механика</option>
                    <option value="heavy_at_focus">Тяжёлые танки и ПТО</option>
                    <option value="aa_defense">ПВО и оборона</option>
                    <option value="max_dpm">Максимум DPM</option>
                    <option value="counter_enemy">Контрпик по ролям</option>
                  </select>
                </div>
                <div class="hint small">
                  Для режима «ИИ против ИИ» задай разные стратегии для Команды 1 и Команды 2.
                </div>
              </div>
            </div>

            <div>
              <div class="form-row">
                <label>Пул игроков для драфта</label>
                <div class="btn-row">
                  <button id="offline-pool-all">Все игроки</button>
                  <button id="offline-pool-top20">Топ-20 по MMR</button>
                  <button id="offline-pool-clear">Очистить</button>
                </div>
              </div>
              <div id="offline-pool-list" class="scroll-panel tall"></div>
            </div>
          </div>
          <button id="offline-start-draft" class="primary-btn" style="margin-top:6px;">Запустить драфт</button>
          <div id="offline-error" class="error-text"></div>
        </div>

        <div class="card">
          <div class="draft-layout">
            <div class="team-column">
              <h4>Команда 1</h4>
              <ul id="offline-team1" class="team-list"></ul>
            </div>
            <div class="center-column">
              <h4>Очередность пиков</h4>
              <div id="offline-pick-order" class="pick-order-row"></div>
              <h4 style="margin-top:8px;">Доступные игроки</h4>
              <div id="offline-available" class="scroll-panel tall"></div>
              <div id="offline-suggestions" class="hint-block"></div>
            </div>
            <div class="team-column">
              <h4>Команда 2</h4>
              <ul id="offline-team2" class="team-list"></ul>
            </div>
          </div>

          <div class="form-row" style="margin-top:10px;">
            <label>Экспорт результата</label>
            <textarea id="offline-export-output" class="export-area" rows="5" readonly></textarea>
            <button id="offline-export-btn">Сформировать текст для копирования</button>
          </div>
        </div>
      </section>

      <!-- Игроки и статистика -->
      <section id="screen-players" class="screen">
        <div class="screen-header">
          <h2>Игроки и статистика</h2>
          <button class="back-btn" data-back>Назад в меню</button>
        </div>

        <div class="card">
          <div class="card-header-row">
            <h3>База игроков</h3>
          </div>
          <div class="card-row">
            <div>
              <div class="form-row">
                <label>Источник данных для драфта</label>
                <select id="players-source">
                  <option value="local">Локальная база (только у тебя)</option>
                  <option value="global">Глобальная база (общие сведения)</option>
                </select>
                <div class="hint small">
                  Глобальную базу может обновлять только админ. Игроки могут её использовать для подсказок ИИ.
                </div>
              </div>
              <div class="form-row">
                <label>Источник стратегий ИИ</label>
                <select id="players-strategy-source">
                  <option value="global">Глобальные (Supabase)</option>
                  <option value="local">Локальные (кэш браузера)</option>
                </select>
                <div class="hint small">Выбор сохраняется и влияет на подсказки и автопики в оффлайне/онлайне.</div>
              </div>
              <div class="form-row">
                <label>Фильтры</label>
                <input type="text" id="players-filter-name" placeholder="Поиск по имени..." />
              </div>
              <div class="form-row">
                <label>Фильтр по Tier</label>
                <select id="players-filter-tier">
                  <option value="">Все</option>
                  <option value="S">S</option>
                  <option value="A">A</option>
                  <option value="B">B</option>
                  <option value="C">C</option>
                  <option value="D">D</option>
                  <option value="F">F</option>
                </select>
              </div>
              <div class="btn-row">
                <button id="players-export-local">Экспорт локальной базы</button>
                <label class="file-btn">
                  Импорт локальной базы
                  <input type="file" id="players-import-local" accept="application/json" style="display:none;" />
                </label>
              </div>
            </div>
            <div>
              <div id="players-list" class="scroll-panel tall"></div>
            </div>
            <div class="edit-panel" id="player-edit-panel"></div>
          </div>
        </div>

        <div class="card" id="strategies-card">
          <div class="card-header-row">
            <h3>Управление стратегиями ИИ</h3>
          </div>
          <div class="card-row">
            <div>
              <div class="form-row">
                <label>Редактор стратегий</label>
                <textarea id="strategies-editor" rows="10" class="export-area"></textarea>
              </div>
              <div class="btn-row">
                <button id="strategies-load-current">Подгрузить активные стратегии</button>
                <button id="strategies-save-local">Сохранить локально</button>
                <label class="file-btn">
                  Импорт JSON
                  <input type="file" id="strategies-import-file" accept="application/json" style="display:none;" />
                </label>
                <button id="strategies-export-file">Экспорт JSON</button>
              </div>
              <div class="hint small">Локальное сохранение кладёт данные в браузер и сразу включает источник «Локальные». Для глобального сохранения используй админ-панель.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Онлайн комнаты -->
      <section id="screen-online" class="screen">
        <div class="screen-header">
          <h2>Онлайн комнаты</h2>
          <button class="back-btn" data-back>Назад в меню</button>
        </div>

        <div class="card">
          <div class="card-row">
            <div>
              <div class="form-row">
                <label>Твой ник в комнате</label>
                <input type="text" id="online-nickname" placeholder="Временный ник (для этой комнаты)" />
              </div>
              <div class="form-row">
                <label>Создать комнату</label>
                <input type="password" id="online-create-password" placeholder="Пароль комнаты (опционально)" />
                <button id="online-create-room">Создать комнату</button>
                <div id="online-create-result" class="hint small"></div>
              </div>
              <div class="form-row">
                <label>Войти в комнату</label>
                <input type="text" id="online-join-code" placeholder="Код комнаты (например, AB3KX)" />
                <input type="password" id="online-join-password" placeholder="Пароль комнаты (если есть)" />
                <button id="online-join-room">Войти</button>
                <div id="online-join-result" class="hint small"></div>
              </div>
            </div>
            <div>
              <div class="form-row">
                <label>Активные комнаты (последние 2 недели)</label>
                <div class="btn-row">
                  <input type="password" id="online-admin-pass" placeholder="Админ-пароль для удаления" />
                  <button id="online-admin-verify">Подтвердить</button>
                  <button id="online-refresh-rooms">Обновить список</button>
                </div>
              </div>
              <div id="online-rooms-list" class="scroll-panel tall"></div>
            </div>
          </div>
        </div>

        <div id="online-room-section" class="card hidden">
          <div class="card-row">
            <div>
              <h3>Комната</h3>
              <div class="room-info">
                <span>Код: <strong id="online-room-code">—</strong></span>
                <span>Роль: <strong id="online-my-role">—</strong></span>
                <span>Статус: <strong id="online-match-status">—</strong></span>
              </div>
              <div class="btn-row" style="margin-top:6px;">
                <button id="online-delete-room" class="danger">Удалить комнату</button>
              </div>

              <div class="form-row" style="margin-top:8px;">
                <label>Настройки матча</label>
                <div class="form-row">
                  <label>Карта</label>
                  <select id="online-map-select"></select>
                </div>
                <div class="form-row">
                  <label>Капитаны команд</label>
                  <div class="dual-select-row">
                    <select id="online-captain1">
                      <option value="">— не выбран —</option>
                    </select>
                    <select id="online-captain2">
                      <option value="">— не выбран —</option>
                    </select>
                  </div>
                </div>
                <div class="form-row">
                  <label>Режим</label>
                  <select id="online-mode-select">
                    <option value="human_vs_human">Капитан 1 vs Капитан 2</option>
                    <option value="human_vs_ai">Я против ИИ</option>
                    <option value="ai_vs_ai">ИИ против ИИ</option>
                  </select>
                </div>
                <div class="form-row">
                  <label>Стратегии ИИ (Команда 1 / Команда 2)</label>
                  <div class="dual-select-row">
                    <select id="online-ai-strategy-1">
                      <option value="balanced">Сбалансированная</option>
                      <option value="infantry_focus">Фокус на пехоте</option>
                      <option value="motorized_focus">Фокус на мотопехоте</option>
                      <option value="tanks_focus">Фокус на танках</option>
                      <option value="artillery_focus">Фокус на арте</option>
                      <option value="infantry_mech_mix">Пехота + механика</option>
                      <option value="heavy_at_focus">Тяжёлые танки и ПТО</option>
                      <option value="aa_defense">ПВО и оборона</option>
                      <option value="max_dpm">Максимум DPM</option>
                      <option value="counter_enemy">Контрпик по ролям</option>
                    </select>
                    <select id="online-ai-strategy-2">
                      <option value="balanced">Сбалансированная</option>
                      <option value="infantry_focus">Фокус на пехоте</option>
                      <option value="motorized_focus">Фокус на мотопехоте</option>
                      <option value="tanks_focus">Фокус на танках</option>
                      <option value="artillery_focus">Фокус на арте</option>
                      <option value="infantry_mech_mix">Пехота + механика</option>
                      <option value="heavy_at_focus">Тяжёлые танки и ПТО</option>
                      <option value="aa_defense">ПВО и оборона</option>
                      <option value="max_dpm">Максимум DPM</option>
                      <option value="counter_enemy">Контрпик по ролям</option>
                    </select>
                  </div>
                </div>
                <div class="form-row">
                  <label>Пул игроков для матча</label>
                  <div class="btn-row">
                    <button id="online-pool-all">Все игроки</button>
                    <button id="online-pool-top20">Топ-20 по MMR</button>
                    <button id="online-pool-clear">Очистить</button>
                  </div>
                  <div id="online-pool-list" class="scroll-panel"></div>
                  <div class="hint small">
                    Управлять пулом игроков и запускать драфт может только создатель комнаты.
                  </div>
                </div>
                <button id="online-start-draft" class="primary-btn">Запустить / передрафтить матч</button>
                <div id="online-error" class="error-text"></div>
              </div>
            </div>

            <div>
              <h3>Участники</h3>
              <div id="online-participants" class="scroll-panel tall"></div>
              <div id="online-creator-panel" class="hint-block hidden" style="margin-top:8px;"></div>
            </div>
          </div>

          <div id="online-draft-block" class="card" style="margin-top:8px;">
            <div class="draft-layout">
              <div class="team-column">
                <h4>Команда 1</h4>
                <ul id="online-team1" class="team-list"></ul>
              </div>
              <div class="center-column">
                <h4>Очередность пиков</h4>
                <div id="online-pick-order" class="pick-order-row"></div>
                <h4 style="margin-top:8px;">Доступные игроки</h4>
                <div id="online-available" class="scroll-panel tall"></div>
                <div id="online-suggestions" class="hint-block"></div>
              </div>
              <div class="team-column">
                <h4>Команда 2</h4>
                <ul id="online-team2" class="team-list"></ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Админ-панель -->
      <section id="screen-admin" class="screen">
        <div class="screen-header">
          <h2>Админ-панель</h2>
          <button class="back-btn" data-back>Назад в меню</button>
        </div>

        <div class="card">
          <h3>Вход в админ-режим</h3>
          <div class="card-row">
            <div>
              <div class="form-row">
                <label>Админ-пароль</label>
                <input type="password" id="admin-password" placeholder="Пароль администратора" />
              </div>
              <button id="admin-login-btn">Войти как админ</button>
              <div id="admin-login-status" class="hint small"></div>
            </div>
            <div id="admin-actions" class="hidden">
              <div class="form-row">
                <label>Глобальная база игроков (Supabase)</label>
                <div class="btn-row">
                  <button id="admin-load-global">Загрузить глобальную базу → локально/глобально</button>
                  <button id="admin-save-global">Сохранить текущую глобальную базу → в Supabase</button>
                </div>
              </div>
              <div class="form-row">
                <label>Стратегии ИИ (JSON ROLE_WEIGHTS)</label>
                <div class="btn-row">
                  <button id="admin-strategies-load">Подгрузить текущие стратегии</button>
                  <button id="admin-strategies-save">Сохранить стратегии локально</button>
                </div>
                <textarea id="admin-strategies-json" class="export-area" rows="6"></textarea>
              </div>
              <div class="form-row">
                <label>Смена админ-пароля (глобально через Supabase)</label>
                <input type="password" id="admin-master-password" placeholder="Мастер-пароль сайта" />
                <input type="password" id="admin-new-password" placeholder="Новый админ-пароль" />
                <button id="admin-change-password-btn">Изменить админ-пароль</button>
                <div id="admin-change-password-status" class="hint small"></div>
              </div>
              <div id="admin-actions-status" class="hint small"></div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="app.js"></script>
</body>
</html>
